<!DOCTYPE html>
<html>
    <head>
        <title>Vineland</title>
        <link rel="icon" href="./static/logo.png">
        <link href="static/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="static/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/> 
    </head>
    <body>
        <nav class="blue" role="navigation">
            <div class="nav-wrapper container">
                <a id="testnamenav" class="brand-logo orange-text text-lighten-2">Vineland</a>
            </div>
        </nav>
        <div id ="change_ui" style="margin-bottom: 20px;">
        </div>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/6.6.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>


        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyATuQBI1JJ9sI4jyLjvKbLQX6pzPeGfOMA",
            authDomain: "amaatraid.firebaseapp.com",
            databaseURL: "https://amaatraid.firebaseio.com",
            projectId: "amaatraid",
            storageBucket: "amaatraid.appspot.com",
            messagingSenderId: "829220285103",
            appId: "1:829220285103:web:61bf5d3ee37e096e65c25a"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        </script>
        <script>
            window.onload = load_ques();
            var age = 9; //TODO: get age in global
            var SA_mapping = [0,0.06,0.12,0.18,0.24,0.30,0.35,0.41,0.47,0.53,0.59,0.65,0.71,0.77,0.83,0.89,0.94,1.0,1.06,1.12,1.18,1.24,1.30,1.35,1.41,1.47,1.53,1.59,1.65,1.71,1.77,1.83,1.89,1.94,2.00,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3.0,3.2,3.3,3.5,3.7,3.8,4.0,4.2,4.3,4.5,4.7,4.8,5.0,5.2,5.4,5.6,5.8,6.0,6.3,6.5,6.8,7.0,7.2,7.4,7.6,7.8,8.0,8.3,8.5,8.8,9.0,9.3,9.7,10.0,10.3,10.5,10.8,11.0,11.3,11.7,12.0,12.6,13.2,13.8,14.4,15.0]
            var text_data;
            var last_correct_ques = 0;
            var no_of_wrong = 0;
            var ques_range = [0,17,34,44,50,56,61,65,70,74,77,81,84,89];
            var current_age_question_set = 0;
            var res = [];
            async function load_ques()
            {
                var resp = await fetch('static/VL/vlques.txt');
                text_data = await resp.text();
                text_data = text_data.split('\n');
                display();
            }

            function display()
            {
                var contents = '';
                res = [];
                var j = 0; 
                for(var i = ques_range[current_age_question_set]; i < ques_range[current_age_question_set+1];i++)
                {
                    contents+=
                    `
                        <div id = "questioncontainer" style = "padding: 5px 0px;" class = "center">
                            <p style="font-size:20px;">${text_data[i]}</p>
                            <div class="row">
                                <div class="col s12">
                                    <button id ="ye${j}" class="btn waves-effect waves-light btn-small teal darken-2" value='yes' onClick="set_result(this.id)">yes</button>
                                    <button id ="no${j}" class="btn waves-effect waves-light btn-small orange lighten-3" value='no' onClick="set_result(this.id)">no</button>
                                </div>
                            </div>
                            <hr style = "border: 1px solid black;">
                        </div>
                    `
                    j+=1;
                    res.push(1);
                }
                contents+= `<div class = "center"><input type = "submit" id = "ques_submit" class="waves-effect waves-light btn-large" onClick="calc_res(this.id)"/></div>`
                document.getElementById("change_ui").innerHTML = contents;
            }

            function set_result(clicked_id)
            {
                var val = clicked_id.slice(0,2)
                var ques = parseInt(clicked_id.slice(2));
            
                if (val == "ye")
                {
                    res[ques] = 1;
                    document.getElementById(`no${ques}`).className ="btn waves-effect waves-light btn-small orange lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small teal darken-2";
                }
                else
                {
                    res[ques] = 0;
                    document.getElementById(`ye${ques}`).className ="btn waves-effect waves-light btn-small teal lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small orange darken-2";
                }
            }

            function calc_res(id)
            {
                window.scrollTo(0,0);
                var j = ques_range[current_age_question_set];
                var flag = false;
                for(var i=0;i<(ques_range[current_age_question_set+1]-ques_range[current_age_question_set]);i++)
                {
                    if(res[i]==0)
                    {
                        no_of_wrong+=1;
                    }
                    else
                    {
                        flag = true;
                        last_correct_ques = j;
                    }
                    j+=1;
                }
                if (current_age_question_set<14 && flag == true)
                {
                    current_age_question_set+=1
                    display();
                }
                else
                {
                    no_of_wrong = no_of_wrong - ((ques_range[current_age_question_set+1]-1)-last_correct_ques);
                    final_score = SA_mapping[last_correct_ques-no_of_wrong+1];
                    no_correct = last_correct_ques-no_of_wrong+1;
                    social_quotient = (final_score/age)*100;
                    //TODO: store final result in a variable
                    document.getElementById("change_ui").innerHTML = 
                    `
                        <h1> ${final_score} </h1>
                        <h1> ${no_correct} </h1>
                        <h1> ${social_quotient} </h1>
                    `;
                }
            }
        </script>
    </body>
</html>