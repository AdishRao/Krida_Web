<!DOCTYPE html>
<html>
    <head>
        <title>Login</title>
        <link rel="icon" href="./static/logo.png">
        <link href="static/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="static/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/> 
    </head>
    <body>
        <nav class="blue" role="navigation"></nav>
        <div id ="change_ui"></div>
        <!-- footer class="page-footer blue" style="overflow: hidden;position: fixed;bottom: 0; width: 100%;">
                <div class="container"></div>
                <div class="footer-copyright">
                  <div class="container">
                    Vincere Solutions | 2017
                  </div>
                </div>
        </footer -->
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/6.6.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>


        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyATuQBI1JJ9sI4jyLjvKbLQX6pzPeGfOMA",
            authDomain: "amaatraid.firebaseapp.com",
            databaseURL: "https://amaatraid.firebaseio.com",
            projectId: "amaatraid",
            storageBucket: "amaatraid.appspot.com",
            messagingSenderId: "829220285103",
            appId: "1:829220285103:web:61bf5d3ee37e096e65c25a"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        </script>
        <script>
            var initial_bst_value = -1, initial_rpm_value = -1, initial_gdt_value = -1, initial_vl_value = -1;
            var database;
            var unique_id;
            var today;
            var age;
            window.onload = login_option();
            var submit = document.getElementById("submit");
            submit.addEventListener('click',login);
            function login_option()
            {
                var contents =
                `
                <h1 class="center blue-text">Login</h1>
                <form class="center">
                    <div class="center row">
                        <div class="col s4"></div>
                        <div class="center col s5">
                            <input type="email" placeholder="Email" id="email_id"/>
                            <input type="password" placeholder="Password" id="password"/>
                            <input type="submit" id="submit"/>
                        </div>
                    </div>
                </form>
                `;
                document.getElementById("change_ui").innerHTML = contents;
            }
            function login(e)
            {
                e.preventDefault();
                var email = document.getElementById("email_id").value;
                var password = document.getElementById("password").value;
                firebase.auth().signInWithEmailAndPassword(email, password)
                .then(function(firebaseUser) {
                    document.getElementById("change_ui").innerHTML="";
                    load_options();
                })
                .catch(function(error) {
                    alert("Wrong Email or Password")
                });
            }

            function load_options()
            {
                var page_content; 
                page_content = 
                '<h1 class="center blue-text">Enter Student Detail</h1>\
                <form class="center">\
                    <div class="center row"><div class="col s4"></div><div class="center col s5">\
                        <input type="text" placeholder="Full Name" id="Name"/>\
                        <input type="number" placeholder="Age [6-9]" id="Age" min="6" max="9"/>\
                        <input type="text" placeholder="Gender" id="Gender"/>\
                        <input type="date" placeholder="DOB" id="DOB"/>\
                        <input type="submit" id="new_student"/>\
                    </div></div>\
                </form>'
                document.getElementById("change_ui").innerHTML=page_content;
                new_student = document.getElementById("new_student");
                new_student.addEventListener('click',add_student);
            }

            function add_student(e)
            {
                e.preventDefault();
                var name = document.getElementById("Name").value;
                age = document.getElementById("Age").value;
                var gender = document.getElementById("Gender").value;
                var dob = document.getElementById("DOB").value;
                var dob = dob.replace(/\//g, "-");
                unique_id = name+dob;
                var current_test = 0;
                database = firebase.database();
                database.ref('Student/' + unique_id).set({
                    "name" : name,
                    "age" : age,
                    "gender" : gender,
                    "dob" : dob
                });
                database.ref(unique_id).set({
                "name" : name,
                "age" : age,
                "gender" : gender,
                "dob" : dob
                });
                today = new Date();
                database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).set({
                rpm: -1,
                bst: -1,
                vineland: -1,
                gdt: -1
                });
                localStorage.setItem("unique_id",unique_id);
                option_loadpage();
            }
        </script>
        <script>
            function option_loadpage()
            {   
                var contents = 
                `
                    <div style="margin-top:15%;">
                        <div class="row center">
                            <div class="col s2"></div>
                            <div class="col s4">
                                    <button id="bst" class="btn-large waves-effect waves-light btn-small teal lighten-2" onClick="bst_load_ques()" style="min-width:310px;">Binet Simon Test</button>
                            </div>
                            <div class="col s4">
                                    <button id="vineland" class="btn-large waves-effect waves-light btn-small teal lighten-2" onClick="vl_load_ques()" style="min-width:310px;">Vineland Scale</button>
                            </div>
                    </div>
                    <div class="row center">
                            <div class="col s2"></div>
                            <div class="col s4">
                                    <button id="gdt" class="btn-large waves-effect waves-light btn-small teal lighten-2" onClick="gdt_load_ques()" style="min-width:310px;">Gessel's Drawing Test</button>
                            </div>
                            <div class="col s4">
                                    <button id="rpm" class="btn-large waves-effect waves-light btn-small teal lighten-2" onClick="rpm_display_set_lower()" style="min-width:310px;">Ravens Progressive Matrix</button>
                            </div>
                        </div>
                    </div>
                `;
                contents+=
                `
                    <br/>
                    <br/>
                    <div class="row center">
                        <div class="col s4"></div>
                        <div class="col s4">
                            <button id="result" class="btn-large waves-effect waves-light btn-small orange lighten-2" onClick="result_loadpage()" style="min-width:310px;">Result</button>
                        </div>
                    </div>
                    <div class="row center">
                        <div class="col s4"></div>
                        <div class="col s4">
                            <button id="new_child" class="btn-large waves-effect waves-light btn-small orange darken-2" onClick="login_option()" style="min-width:310px;margin-top:10px;">New Student</button>
                        </div>
                    </div>

                `;
                document.getElementById("change_ui").innerHTML = contents;
                if(initial_bst_value==-1&&initial_gdt_value==-1&&initial_vl_value==-1&&initial_rpm_value==-1)
                {
                    document.getElementById("result").setAttribute("disabled",'true');
                }
                if(initial_bst_value!=-1)
                {
                    document.getElementById("bst").setAttribute("disabled",'true');
                }
                if(initial_gdt_value!=-1)
                {
                    document.getElementById("gdt").setAttribute("disabled",'true');
                }
                if(initial_rpm_value!=-1)
                {
                    document.getElementById("rpm").setAttribute("disabled",'true');
                }
                if(initial_vl_value!=-1)
                {
                    document.getElementById("vineland").setAttribute("disabled",'true');
                }
            }
        </script>
        <script>
            var rpm_result  = [0,0,0,0,0,0,0,0,0,0,0,0];
            var rpm_answers = [[4,5,1,2,6,3,6,2,1,3,5,4],[2,6,1,2,1,3,5,6,4,3,4,5],[8,2,3,8,7,4,5,1,7,6,1,2],[3,4,3,7,8,6,5,4,1,2,5,6],[7,6,8,2,1,5,2,4,1,6,3,5]];
            var rpm_section_no = 0;
            var rpm_score = 0;
            var rpm_age = age; //TODO: get age in global
            var rpm_image_no = 1;
            var rpm_final_result = 0;

            function rpm_display_set_lower()
            {
                var rpm_content = '';
                for(var rpm_ques_num=1;rpm_ques_num<13;rpm_ques_num++)
                {
                    rpm_content+=
                    `<div style="padding:30px 0px;" id="ques_seperator">
                    <div id="ques${rpm_ques_num}" style="clear: both; padding: 15px 0px;" class="question">
                        <div style="float: left; width: 50%; padding:30px 0px 45px;" ><img src="static/RPM/A${rpm_image_no}.png" id="img${rpm_ques_num}" width="700px" height="500px"/></div>
                        <div style="float: right; width:50%; margin-top:120px;" class="center">
                            <h5>Choose The Right Pattern</h5>
                            <table style="margin-top: 130px;">
                                <tr>
                                    <td class="center"><button id ="ans${rpm_ques_num}1" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=1 onClick="rpm_set_result(this.id)">1</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}2" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=2 onClick="rpm_set_result(this.id)">2</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}3" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=3 onClick="rpm_set_result(this.id)">3</button></td>
                                </tr>
                                <tr>
                                    <td class="center"><button id ="ans${rpm_ques_num}4" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=4 onClick="rpm_set_result(this.id)">4</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}5" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=5 onClick="rpm_set_result(this.id)">5</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}6" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=6 onClick="rpm_set_result(this.id)">6</button></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    </div>
                    <hr style="border: 1px solid black;clear: both;"/>`
                    rpm_image_no+=1
                }
                rpm_content+=
                `<div class="center" style="padding:50px 0px 10px;">
                    <input id="${rpm_section_no}submit" class="waves-effect waves-light btn-large" type="submit" onClick="rpm_calc_res(this.id)"/>
                </div>`
            document.getElementById("change_ui").innerHTML = rpm_content;
            }

            function rpm_display_set_higher()
            {
                var rpm_content = '';
                for(var rpm_ques_num=1;rpm_ques_num<13;rpm_ques_num++)
                {
                    rpm_content+=
                    `<div style="padding:30px 0px" id="ques_seperator">
                    <div id="ques${rpm_ques_num}" style="clear: both; padding: 15px 0px;" class="question">
                        <div style="float: left; width: 50%; padding:30px 0px 45px;" ><img src="static/RPM/A${rpm_image_no}.png" id="img${rpm_ques_num}" width="700px" height="500px"/></div>
                        <div style="float: right; width:50%; margin-top:120px;" class="center">
                            <h5>Choose The Right Pattern</h5>
                            <table style="margin-top: 130px;">
                                <tr>
                                    <td class="center"><button id ="ans${rpm_ques_num}1" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=1 onClick="rpm_set_result(this.id)">1</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}2" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=2 onClick="rpm_set_result(this.id)">2</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}3" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=3 onClick="rpm_set_result(this.id)">3</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}4" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=4 onClick="rpm_set_result(this.id)">4</button></td>
                                </tr>
                                <tr>
                                    <td class="center"><button id ="ans${rpm_ques_num}5" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=5 onClick="rpm_set_result(this.id)">5</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}6" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=6 onClick="rpm_set_result(this.id)">6</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}7" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=7 onClick="rpm_set_result(this.id)">7</button></td>
                                    <td class="center"><button id ="ans${rpm_ques_num}8" class="waves-effect waves-light btn-large teal lighten-3" style="width: 100px; height: 60px;" value=8 onClick="rpm_set_result(this.id)">8</button></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <hr style="border: 1px solid black;clear: both;"/>`
                    rpm_image_no+=1
                }
                rpm_content+=
                `<div class="center" style="padding:50px 0px 10px;">
                    <input id="${rpm_section_no}submit" class="waves-effect waves-light btn-large" type="submit" onClick="rpm_calc_res(this.id)"/>
                </div>`
                document.getElementById("change_ui").innerHTML = rpm_content;
            }

            function rpm_nextChar(c) {
                return String.fromCharCode(c.charCodeAt(0) + 1);
            }

            async function rpm_cal_final_res(){
                window.scrollTo(0,0);
                if (rpm_score==0)
                {
                    database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                        'rpm': rpm_score 
                        });
                    initial_rpm_value = 0;
                    option_loadpage();
                }
                const rpm_q = await fetch('static/RPM/rpmresult.csv');
                const rpm_data = await rpm_q.text();
                var rpm_rows = rpm_data.split('\n').slice(2);
                rpm_rows.forEach(row=>{
                    const column = row.split(',');
                    if(column[0] == rpm_score)
                    {
                        rpm_final_result = column[rpm_age-5];
                    }
                });
                initial_rpm_value = rpm_final_result;
                database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                    'rpm': rpm_final_result 
                    });
                option_loadpage();
            }

            function rpm_calc_res(clicked_id)
            {
                for(var i =0;i<12;i++)
                {
                    if(rpm_result[i]==rpm_answers[rpm_section_no][i])
                    {
                        rpm_score+=1;
                    }
                }
                rpm_result  = [0,0,0,0,0,0,0,0,0,0,0,0];
                window.scrollTo(0,0);
                rpm_section_no+=1;
                if (rpm_section_no<2)
                {
                    rpm_display_set_lower();
                }
                else if (rpm_section_no<5)
                {
                    rpm_display_set_higher();
                }
                else
                {
                    rpm_cal_final_res();
                }
            }

            function rpm_set_result(clicked_id)
            {
                var rpm_ques = parseInt(clicked_id.slice(3,clicked_id.length-1))-1;
                var rpm_val = clicked_id[clicked_id.length-1];
                rpm_result[rpm_ques] = parseInt(rpm_val);
                var id = clicked_id.slice(0,clicked_id.length-1);
                if (rpm_section_no<2)
                {
                    for(var i=1;i<7;i++)
                    {
                        var set_id = id.concat(i);
                        document.getElementById(set_id).className ="waves-effect waves-light btn-large teal lighten-3";
                    }
                }
                else
                {
                    for(var i=1;i<9;i++)
                    {
                        var set_id = id.concat(i);
                        document.getElementById(set_id).className ="waves-effect waves-light btn-large teal lighten-3";
                    }
                }
                document.getElementById(clicked_id).className ="waves-effect waves-light btn-large teal darken-2";
            }
        </script>
        <script>
            var bst_age = age;
            var bst_image_present = [1,1,0,1,1,1,0,0];
            var bst_question_count = 0;
            var bst_basal_age = 2.0;
            var bst_additive_age = 0.0;
            var bst_questions = [[],[],[],[],[],[],[],[]];
            var bst_correct_no = 0;
            var bst_temp_res = [1,1,1,1,1];
            async function bst_load_ques(){
                const q = await fetch('static/BST/bst.csv');
                const data = await q.text();
                var rows = data.split('\n').slice(1);
                
                rows.forEach(row=>{
                    const column = row.split(',');
                    for(var i =0;i<8;i++){
                        bst_questions[i].push(column[i]);
                    }
                });
                bst_disp_questions();
            }
            function bst_disp_questions()
            {
                var bst_temp_questions = bst_questions[bst_question_count];
                var bst_contents = '';
                bst_contents+=
                `
                    <div id = "bst_image" style="float:right;width:40%;margin-top:100px;"></div>
                    <div id = "bst_questions" style="float:left;width:60%"></div>

                `; 
                document.getElementById("change_ui").innerHTML=bst_contents;
                var inner_contents = '';
                for(var i=0;i<bst_temp_questions.length;i++)
                {
                    if(bst_temp_questions[i]!="")
                    {
                        inner_contents+=
                        `
                            <p style="font-size:20px;padding:15px;">${bst_temp_questions[i]}</p>
                            <div class="row">
                                <div class="col s8">
                                    <button id ="ye${i}" class="btn waves-effect waves-light btn-small teal darken-2" value='yes' onClick="bst_set_result(this.id)">yes</button>
                                    <button id ="no${i}" class="btn waves-effect waves-light btn-small orange lighten-3" value='no' onClick="bst_set_result(this.id)">no</button>
                                </div>
                            </div>
                        `;
                    }
                }
                inner_contents+=`<div class = "center"><input type = "submit" id = "ques_submit" class="waves-effect waves-light btn-large" onClick="bst_calc_res(this.id)"/></div>`;
                document.getElementById("bst_questions").innerHTML=inner_contents;
                if(bst_image_present[bst_question_count]==1)
                {
                    document.getElementById("bst_image").innerHTML=`<img src='static/BST/age${bst_question_count+3}.png' width="70%"/>`;
                }
            }
            function bst_set_result(clicked_id)
            {
                var val = clicked_id.slice(0,2)
                var ques = parseInt(clicked_id.slice(2));
            
                if (val == "ye")
                {
                    bst_temp_res[ques] = 1;
                    document.getElementById(`no${ques}`).className ="btn waves-effect waves-light btn-small orange lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small teal darken-2";
                }
                else
                {
                    bst_temp_res[ques] = 0;
                    document.getElementById(`ye${ques}`).className ="btn waves-effect waves-light btn-small teal lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small orange darken-2";
                }
            }
            function bst_calc_res(clicked_id)
            {
                window.scrollTo(0,0);
                var flag = false;
                var all_correct = true;
                for(var i=0;i<5;i++)
                {
                    if(bst_temp_res[i]==1)
                    {
                        flag = true;
                    }
                    if(bst_temp_res[i]==0)
                    {
                        all_correct = false;
                    }
                }
                if(flag==false||bst_question_count==7)
                {
                    bst_display_result();
                }
                else
                {
                    if(all_correct==true)
                    {
                        bst_basal_age+=1;
                    }
                    else if(bst_question_count==1)
                    {
                        for(var i=0;i<4;i++)
                        {
                            if(bst_temp_res[i]==1)
                            {
                                bst_additive_age+=3;
                            }
                        }
                    }
                    else
                    {
                        for(var i=0;i<5;i++)
                        {
                            if(bst_temp_res[i]==1)
                            {
                                bst_additive_age+=2.4;
                            }
                        }
                    }
                    bst_question_count+=1;
                    bst_disp_questions();
                }
            }

            function bst_display_result()
            {
                while (bst_additive_age>=12)
                {
                    bst_basal_age+=1;
                    bst_additive_age-=12;
                }
                bst_final_result = ((bst_basal_age*12+bst_additive_age)/(bst_age*12))*100;
                initial_bst_value = bst_final_result;
                database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                    'bst': bst_final_result 
                    });
                window.scrollTo(0,0);
                option_loadpage();
            }
        </script>
        <script>
            var gdt_count = 10;
            var gdt_wrong_count = 0;
            var gdt_question_count = 1;
            var gdt_count_holder = [];
            var gdt_agegroup = [11,13,17,20,24];
            var gdt_age = age;
            var gdt_final_result;
            function gdt_load_ques()
            {
                var gdt_content = '';
                var gdt_inital_questions = ["Palmer hold on writing instruments?","Spontaneous scribble?", "Purposive horizontal scribble?", "Makes dots?", "Tripod hold on writing instruments?", "Purposive vertical scribble?", "Imitates vertical strokes?", "Extends tail to dots in different directions?", "Imitates horizontal strokes?", "Traces outline of objects/ palm on paper?"];
                for(var i=0; i<gdt_inital_questions.length;i++)
                {
                    gdt_content+=
                    `
                        <div id = "question${i}" style = "padding: 20px 0px;" class = "center">
                            <div class = "row" style="margin-bottom: 5px">
                                <div class ="col s3"></div>
                                <div class ="col s4">
                                <p style="font-size:20px;"> ${gdt_inital_questions[i]}</p>
                                </div>
                                <div class ="col s4" style="padding-top:15px">
                                        <button id ="${i}" class="btn waves-effect waves-light btn-small orange lighten-3" onClick="gdt_set_result(this.id)">no</button>
                                </div>
                            </div>
                        </div>
                    `
                }
                gdt_content+= `
                <div class="row">
                    <div class="col s6"></div>
                    <div class = "center">
                        <input type = "submit" id = "submit" class="waves-effect waves-light btn-large" onClick="gdt_display()"/>
                    </div>
                </div>
                `
                document.getElementById("change_ui").innerHTML = gdt_content;
            }
            function gdt_set_result(clicked_id)
            {
                gdt_count-=1;
                document.getElementById(clicked_id).className = 'btn waves-effect waves-light btn-small orange darken-2';
            }
            function gdt_display()
            {   
                window.scrollTo(0,0);
                var gdt_contents = '';
                for(var i=1;i<=gdt_agegroup[gdt_age-6];i++)
                {
                    gdt_contents+=
                    `
                    <div id = "question${i}" style = "padding: 5px 0px;" class = "center">
                        <div style="float:left; width:70%;">
                            <img src = "/static/GDT/GDT${i}.png" width=600px height=600px />
                        </div> 
                        <div style="float:right; width:30%;">
                            <button id ="y${i}" class="btn waves-effect waves-light btn-small teal darken-3" onClick="gdt_set_result_image(this.id)" style="margin-top:260px;">yes</button>
                            <button id ="n${i}" class="btn waves-effect waves-light btn-small orange lighten-3" onClick="gdt_set_result_image(this.id)" style="margin-top:260px;">no</button>
                        </div>
                    </div> 
                    `
                    gdt_count_holder.push(1);
                }
                gdt_contents+=
                `
                <div style = "padding: 5px 0px;" class = "center">
                    <div style="float:left; width:70%;">
                    </div> 
                    <div style="float:right; width:30%;">
                        <input type = "submit" id = "submit2" class="waves-effect waves-light btn-large" onClick="gdt_finish()"/>
                    </div>
                </div> 
                `
                document.getElementById("change_ui").innerHTML = gdt_contents;
            }
            function gdt_set_result_image(click_id)
            {
                var gdt_val = click_id[0];
                var gdt_number = click_id.slice(1);
                if (gdt_val=="y")
                {
                    gdt_count_holder[gdt_number] = 1;
                    document.getElementById(click_id).className = "btn waves-effect waves-light btn-small teal darken-3";
                    document.getElementById(`n${gdt_number}`).className = "btn waves-effect waves-light btn-small orange lighten-3";
                }
                else
                {
                    gdt_count_holder[gdt_number] = 0;
                    document.getElementById(click_id).className = "btn waves-effect waves-light btn-small orange darken-2";
                    document.getElementById(`y${gdt_number}`).className = "btn waves-effect waves-light btn-small teal lighten-3";
                }
            }
            async function gdt_finish()
            {
                for(var i=1;i<=gdt_agegroup[gdt_age-6];i++)
                {
                    if (gdt_count_holder[i]==0)
                    {
                        gdt_wrong_count+=1;
                    }
                }
                gdt_count = gdt_count + gdt_agegroup[gdt_age-6] - gdt_wrong_count;
                window.scrollTo(0,0);
                if (gdt_count==0)
                {
                    database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                        'gdt': gdt_count 
                        });
                    gdt_final_result = 0;
                    option_loadpage();
                }
                const gdt_q = await fetch('static/GDT/GDT.csv');
                const gdt_data = await gdt_q.text();
                var gdt_rows = gdt_data.split('\n').slice(2);
                gdt_rows.forEach( (row, index) => {
                    const column = row.split(',');
                    if(index == gdt_count)
                    {
                        gdt_final_result = column[gdt_age-3];
                    }
                });
                database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                    'gdt': gdt_final_result 
                    });
                initial_gdt_value = gdt_final_result;
                option_loadpage();
            }
        </script>
        <script>
            var vl_age = age; //TODO: get age in global
            var vl_SA_mapping = [0,0.06,0.12,0.18,0.24,0.30,0.35,0.41,0.47,0.53,0.59,0.65,0.71,0.77,0.83,0.89,0.94,1.0,1.06,1.12,1.18,1.24,1.30,1.35,1.41,1.47,1.53,1.59,1.65,1.71,1.77,1.83,1.89,1.94,2.00,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3.0,3.2,3.3,3.5,3.7,3.8,4.0,4.2,4.3,4.5,4.7,4.8,5.0,5.2,5.4,5.6,5.8,6.0,6.3,6.5,6.8,7.0,7.2,7.4,7.6,7.8,8.0,8.3,8.5,8.8,9.0,9.3,9.7,10.0,10.3,10.5,10.8,11.0,11.3,11.7,12.0,12.6,13.2,13.8,14.4,15.0]
            var vl_text_data;
            var vl_last_correct_ques = 0;
            var vl_no_of_wrong = 0;
            var vl_ques_range = [0,17,34,44,50,56,61,65,70,74,77,81,84,89];
            var vl_current_age_question_set = 0;
            var vl_res = [];
            async function vl_load_ques()
            {
                var resp = await fetch('static/VL/vlques.txt');
                vl_text_data = await resp.text();
                vl_text_data = vl_text_data.split('\n');
                vl_display();
            }

            function vl_display()
            {
                var contents = '';
                vl_res = [];
                var j = 0; 
                for(var i = vl_ques_range[vl_current_age_question_set]; i < vl_ques_range[vl_current_age_question_set+1];i++)
                {
                    contents+=
                    `
                        <div id = "questioncontainer" style = "padding: 5px 0px;" class = "center">
                            <p style="font-size:20px;">${vl_text_data[i]}</p>
                            <div class="row">
                                <div class="col s12">
                                    <button id ="ye${j}" class="btn waves-effect waves-light btn-small teal darken-2" value='yes' onClick="vl_set_result(this.id)">yes</button>
                                    <button id ="no${j}" class="btn waves-effect waves-light btn-small orange lighten-3" value='no' onClick="vl_set_result(this.id)">no</button>
                                </div>
                            </div>
                            <hr style = "border: 1px solid black;">
                        </div>
                    `
                    j+=1;
                    vl_res.push(1);
                }
                contents+= `<div class = "center"><input type = "submit" id = "ques_submit" class="waves-effect waves-light btn-large" onClick="vl_calc_res(this.id)"/></div>`
                document.getElementById("change_ui").innerHTML = contents;
            }

            function vl_set_result(clicked_id)
            {
                var val = clicked_id.slice(0,2)
                var ques = parseInt(clicked_id.slice(2));
            
                if (val == "ye")
                {
                    vl_res[ques] = 1;
                    document.getElementById(`no${ques}`).className ="btn waves-effect waves-light btn-small orange lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small teal darken-2";
                }
                else
                {
                    vl_res[ques] = 0;
                    document.getElementById(`ye${ques}`).className ="btn waves-effect waves-light btn-small teal lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small orange darken-2";
                }
            }

            function vl_calc_res(id)
            {
                window.scrollTo(0,0);
                var j = vl_ques_range[vl_current_age_question_set];
                var flag = false;
                for(var i=0;i<(vl_ques_range[vl_current_age_question_set+1]-vl_ques_range[vl_current_age_question_set]);i++)
                {
                    if(vl_res[i]==0)
                    {
                        vl_no_of_wrong+=1;
                    }
                    else
                    {
                        flag = true;
                        vl_last_correct_ques = j;
                    }
                    j+=1;
                }
                if (vl_current_age_question_set<14 && flag == true)
                {
                    vl_current_age_question_set+=1
                    vl_display();
                }
                else
                {
                    vl_no_of_wrong = vl_no_of_wrong - ((vl_ques_range[vl_current_age_question_set+1]-1)-vl_last_correct_ques);
                    vl_final_score = vl_SA_mapping[vl_last_correct_ques-vl_no_of_wrong+1];
                    vl_no_correct = vl_last_correct_ques-vl_no_of_wrong+1;
                    vl_social_quotient = (vl_final_score/vl_age)*100;
                    initial_vl_value = vl_social_quotient;
                    database.ref(unique_id+'/'+(today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear())).update({
                        'vineland': vl_social_quotient 
                        });
                    option_loadpage()
                }
            }
        </script>
        <script>
            function result_loadpage()
            {   
                var contents = 
                `
                <div style='margin-top:8%;padding:0px 10px;'>
                    <table id='add_result' style="border: 5px solid teal;">
                    </table>
                </div>
                `;
                document.getElementById("change_ui").innerHTML = contents;
                var inner_contents = 
                `
                <tr class="lighten-5 teal">
                    <td>Test Name</td><td>Score</td><td>Assessment</td>
                </tr> 
                `;
                var strid  = '';
                if(initial_vl_value!=-1)
                {
                    if (initial_vl_value<20)
                    {strid = "Profound Intellectual Disability";}
                    else if (initial_vl_value <35)
                        {strid = "Severe Intellectual Disability";}
                    else if (initial_vl_value <50)
                        {strid = "Moderate Intellectual Disability";}
                    else if (initial_vl_value < 70)
                        {strid = "Mild Intellectual Disability";}
                    else if (initial_vl_value < 90)
                        {strid = "Borderline Intellectual Disability";}
                    else {strid = "Not Intellectual Disability";}
                    inner_contents+=
                    `
                    <tr>
                        <td>Vineland Scale</td><td>${initial_vl_value}</td><td>${strid}</td>
                    </tr> 
                    `;
                }
                if(initial_bst_value!=-1)
                {
                    if (initial_bst_value<20)
                        {strid = "Profound Intellectual Disability";}
                    else if (initial_bst_value <35)
                        {strid = "Severe Intellectual Disability";}
                    else if (initial_bst_value <50)
                        {strid = "Moderate Intellectual Disability";}
                    else if (initial_bst_value < 70)
                        {strid = "Mild Intellectual Disability";}
                    else if (initial_bst_value < 90)
                        {strid = "Borderline Intellectual Disability";}
                    else {strid = "Not Intellectual Disability";}
                    inner_contents+=
                    `
                    <tr>
                        <td>Binet Simon Test</td><td>${initial_bst_value}</td><td>${strid}</td>
                    </tr> 
                    `;
                }
                if(initial_gdt_value!=-1)
                {
                    if (initial_gdt_value<20)
                    {strid = "Intellectual Disability";}
                    else {strid = "Not Intellectual Disability";}
                    inner_contents+=
                    `
                    <tr>
                        <td>Gessel's  Drawing Test</td><td>${initial_gdt_value}</td><td>${strid}</td>
                    </tr> 
                    `;
                }
                if(initial_rpm_value!=-1)
                {
                    if (initial_rpm_value<26)
                    {strid = "Intellectual Disability";}
                    else {strid = "Not Intellectual Disability";}
                    inner_contents+=
                    `
                    <tr>
                        <td>Raven's Progressive Matrix</td><td>${initial_rpm_value}</td><td>${strid}</td>
                    </tr> 
                    `;
                }
                document.getElementById("add_result").innerHTML = inner_contents;
            }
        </script>
    </body>
</html>
