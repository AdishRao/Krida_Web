<!DOCTYPE html>
<html>
    <head>
        <title>Binet Simon Test</title>
        <link rel="icon" href="./static/logo.png">
        <link href="static/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="static/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/> 
    </head>
    <body>
        <nav class="blue" role="navigation">
            <div class="nav-wrapper container">
                <a id="testnamenav" class="brand-logo orange-text text-lighten-2">Binet Simon Test</a>
            </div>
        </nav>
        <div id ="change_ui" style="margin-bottom: 60px;">
        </div>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/6.6.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyATuQBI1JJ9sI4jyLjvKbLQX6pzPeGfOMA",
            authDomain: "amaatraid.firebaseapp.com",
            databaseURL: "https://amaatraid.firebaseio.com",
            projectId: "amaatraid",
            storageBucket: "amaatraid.appspot.com",
            messagingSenderId: "829220285103",
            appId: "1:829220285103:web:61bf5d3ee37e096e65c25a"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        </script>
        <script>
            window.onload = bst_load_ques();
            var bst_age = 6;
            var bst_image_present = [1,1,0,1,1,1,0,0];
            var bst_question_count = 0;
            var bst_basal_age = 2.0;
            var bst_additive_age = 0.0;
            var bst_questions = [[],[],[],[],[],[],[],[]];
            var bst_correct_no = 0;
            var bst_temp_res = [1,1,1,1,1];
            async function bst_load_ques(){
                const q = await fetch('static/BST/bst.csv');
                const data = await q.text();
                var rows = data.split('\n').slice(1);
                
                rows.forEach(row=>{
                    const column = row.split(',');
                    for(var i =0;i<8;i++){
                        bst_questions[i].push(column[i]);
                    }
                });
                bst_disp_questions();
            }
            function bst_disp_questions()
            {
                var bst_temp_questions = bst_questions[bst_question_count];
                var bst_contents = '';
                bst_contents+=
                `
                    <div id = "bst_image" style="float:right;width:40%;margin-top:100px;"></div>
                    <div id = "bst_questions" style="float:left;width:60%"></div>

                `; 
                document.getElementById("change_ui").innerHTML=bst_contents;
                var inner_contents = '';
                for(var i=0;i<bst_temp_questions.length;i++)
                {
                    if(bst_temp_questions[i]!="")
                    {
                        inner_contents+=
                        `
                            <p style="font-size:20px;padding:15px;">${bst_temp_questions[i]}</p>
                            <div class="row">
                                <div class="col s8">
                                    <button id ="ye${i}" class="btn waves-effect waves-light btn-small teal darken-2" value='yes' onClick="bst_set_result(this.id)">yes</button>
                                    <button id ="no${i}" class="btn waves-effect waves-light btn-small orange lighten-3" value='no' onClick="bst_set_result(this.id)">no</button>
                                </div>
                            </div>
                        `;
                    }
                }
                inner_contents+=`<div class = "center"><input type = "submit" id = "ques_submit" class="waves-effect waves-light btn-large" onClick="bst_calc_res(this.id)"/></div>`;
                document.getElementById("bst_questions").innerHTML=inner_contents;
                if(bst_image_present[bst_question_count]==1)
                {
                    document.getElementById("bst_image").innerHTML=`<img src='static/BST/age${bst_question_count+3}.png' width="70%"/>`;
                }
            }
            function bst_set_result(clicked_id)
            {
                var val = clicked_id.slice(0,2)
                var ques = parseInt(clicked_id.slice(2));
            
                if (val == "ye")
                {
                    bst_temp_res[ques] = 1;
                    document.getElementById(`no${ques}`).className ="btn waves-effect waves-light btn-small orange lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small teal darken-2";
                }
                else
                {
                    bst_temp_res[ques] = 0;
                    document.getElementById(`ye${ques}`).className ="btn waves-effect waves-light btn-small teal lighten-3";
                    document.getElementById(clicked_id).className ="btn waves-effect waves-light btn-small orange darken-2";
                }
            }
            function bst_calc_res(clicked_id)
            {
                window.scrollTo(0,0);
                var flag = false;
                var all_correct = true;
                for(var i=0;i<5;i++)
                {
                    if(bst_temp_res[i]==1)
                    {
                        flag = true;
                    }
                    if(bst_temp_res[i]==0)
                    {
                        all_correct = false;
                    }
                }
                if(flag==false||bst_question_count==7)
                {
                    bst_display_result();
                }
                else
                {
                    if(all_correct==true)
                    {
                        bst_basal_age+=1;
                    }
                    else if(bst_question_count==1)
                    {
                        for(var i=0;i<4;i++)
                        {
                            if(bst_temp_res[i]==1)
                            {
                                bst_additive_age+=3;
                            }
                        }
                    }
                    else
                    {
                        for(var i=0;i<5;i++)
                        {
                            if(bst_temp_res[i]==1)
                            {
                                bst_additive_age+=2.4;
                            }
                        }
                    }
                    bst_question_count+=1;
                    bst_disp_questions();
                }
            }

            function bst_display_result()
            {
                while (bst_additive_age>=12)
                {
                    bst_basal_age+=1;
                    bst_additive_age-=12;
                }
                bst_final_result = ((bst_basal_age*12+bst_additive_age)/(bst_age*12))*100;
                var contents = `<h1>${bst_final_result}</h1><h1>${bst_basal_age}</h1><h1>${bst_additive_age}</h1>`
                document.getElementById("change_ui").innerHTML = contents;
                initial_bst_value = bst_final_result;
            }
        </script>
    </body>
</html>